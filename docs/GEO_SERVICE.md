# –ì–µ–æ—Å–µ—Ä–≤–∏—Å (GeoService)

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π, –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∞–¥—Ä–µ—Å–æ–≤ –∏ —Ä–∞—Å—á—ë—Ç–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–¥—Ä–µ—Å ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –≤ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:

```python
geo_service = GeoService()
coordinates = await geo_service.geocode_address("–ë–∞—Ä–Ω–∞—É–ª, –ö–∏—Ä–æ–≤–∞ 10")
# –†–µ–∑—É–ª—å—Ç–∞—Ç: (53.3606, 83.7636) –∏–ª–∏ None –µ—Å–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
```

### 2. –û–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí –∞–¥—Ä–µ—Å)

–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º:

```python
address = await geo_service.get_address_from_coordinates(53.3606, 83.7636)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "—É–ª–∏—Ü–∞ –ö–∏—Ä–æ–≤–∞, 10, –ë–∞—Ä–Ω–∞—É–ª, ..."
```

### 3. –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

–í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º:

```python
distance = geo_service.calculate_distance(
    (53.3606, 83.7636),  # –¢–æ—á–∫–∞ A
    (55.7558, 37.6173)   # –¢–æ—á–∫–∞ B
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ

### –í–∞—Ä–∏–∞–Ω—Ç—ã –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

1. **–¢–µ–∫—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∞–¥—Ä–µ—Å —Ç–µ–∫—Å—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ë–∞—Ä–Ω–∞—É–ª, –ö–∏—Ä–æ–≤–∞ 10")
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–æ–∫–æ–¥–∏—Ä—É–µ—Ç –∞–¥—Ä–µ—Å –∏ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

2. **–ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
   - Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å

3. **–í—ã–±—Ä–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ** (–∫–∞–∫ –≤ –Ø–Ω–¥–µ–∫—Å GO)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "üó∫ –í—ã–±—Ä–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ"
   - –ë–æ—Ç –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç: –Ω–∞–∂–∞—Ç—å üìé ‚Üí –ì–µ–æ–ø–æ–∑–∏—Ü–∏—è ‚Üí –≤—ã–±—Ä–∞—Ç—å —Ç–æ—á–∫—É
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ª—é–±—É—é —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ
   - –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∞–¥—Ä–µ—Å

## –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ–±–µ–∏—Ö —Ç–æ—á–µ–∫ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–≥—Ä—É–∑–∫–∞):

1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:
   ```
   –¶–µ–Ω–∞ = –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ + (–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ √ó –¢–∞—Ä–∏—Ñ –∑–∞ –∫–º) + (–í–µ—Å √ó –¢–∞—Ä–∏—Ñ –∑–∞ –∫–≥)
   ```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `geopy` (Nominatim)
- **–¢–æ—á–Ω–æ—Å—Ç—å**: –≥–µ–æ–¥–µ–∑–∏—á–µ—Å–∫–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è (—É—á–∏—Ç—ã–≤–∞–µ—Ç –∫—Ä–∏–≤–∏–∑–Ω—É –ó–µ–º–ª–∏)
- **–¢–∞–π–º–∞—É—Ç**: 10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- **–Ø–∑—ã–∫**: –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ï—Å–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —É—Ç–æ—á–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
- –ï—Å–ª–∏ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (5 –∫–º)
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞:

```python
geo_service = GeoService()
coordinates = await geo_service.geocode_address(message.text)

if coordinates:
    await state.update_data(
        load_address=message.text,
        load_latitude=coordinates[0],
        load_longitude=coordinates[1]
    )
else:
    await message.answer("‚ùå –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

### –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:

```python
geo_service = GeoService()
address = await geo_service.get_address_from_coordinates(
    location.latitude,
    location.longitude
)
```

### –ü—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:

```python
geo_service = GeoService()
distance_km = geo_service.calculate_distance(
    (load_lat, load_lon),
    (unload_lat, unload_lon)
)
price = settings.base_price + (distance_km * settings.price_per_km) + (weight * settings.price_per_kg)
```

